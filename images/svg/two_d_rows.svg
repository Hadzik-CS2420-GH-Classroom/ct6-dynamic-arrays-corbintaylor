<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 860 455" font-family="Consolas, 'Courier New', monospace" font-size="14">
  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#569cd6"/>
    </marker>
    <marker id="arrow-green" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#4ec9b0"/>
    </marker>
    <marker id="arrow-amber" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#dcdcaa"/>
    </marker>
    <marker id="arrow-pink" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#c586c0"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="860" height="455" fill="#1e1e1e" rx="8"/>

  <!-- Title -->
  <text x="430" y="35" text-anchor="middle" fill="#569cd6" font-size="18" font-weight="bold">Step 2: Allocate Each Row</text>
  <text x="430" y="58" text-anchor="middle" fill="#608b4e" font-size="12">for (int i = 0; i &lt; rows; ++i)  table[i] = new int[cols];   // cols = 4</text>

  <!-- STACK label -->
  <text x="30" y="95" fill="#569cd6" font-size="11" font-weight="bold">STACK</text>
  <line x1="30" y1="99" x2="150" y2="99" stroke="#569cd6" stroke-width="1" stroke-dasharray="3,2"/>

  <!-- HEAP label -->
  <text x="210" y="95" fill="#4ec9b0" font-size="11" font-weight="bold">HEAP</text>
  <line x1="210" y1="99" x2="820" y2="99" stroke="#4ec9b0" stroke-width="1" stroke-dasharray="3,2"/>

  <!-- table variable on stack -->
  <rect x="30" y="110" width="110" height="50" rx="6" fill="#2d2d2d" stroke="#c586c0" stroke-width="2"/>
  <text x="85" y="131" text-anchor="middle" fill="#c586c0" font-size="11" font-weight="bold">int**</text>
  <text x="85" y="150" text-anchor="middle" fill="#9cdcfe" font-size="13">table</text>

  <!-- Arrow from table to spine -->
  <line x1="140" y1="135" x2="208" y2="135" stroke="#c586c0" stroke-width="2" marker-end="url(#arrow-pink)"/>

  <!-- Spine: array of 3 int* pointers -->
  <rect x="220" y="108" width="110" height="140" rx="6" fill="#2d2d2d" stroke="#569cd6" stroke-width="2"/>

  <!-- table[0] -->
  <rect x="230" y="117" width="90" height="32" rx="4" fill="#1e1e1e" stroke="#569cd6" stroke-width="1.5"/>
  <text x="275" y="138" text-anchor="middle" fill="#9cdcfe" font-size="11">table[0]</text>

  <!-- table[1] -->
  <rect x="230" y="157" width="90" height="32" rx="4" fill="#1e1e1e" stroke="#dcdcaa" stroke-width="1.5"/>
  <text x="275" y="178" text-anchor="middle" fill="#9cdcfe" font-size="11">table[1]</text>

  <!-- table[2] -->
  <rect x="230" y="197" width="90" height="32" rx="4" fill="#1e1e1e" stroke="#4ec9b0" stroke-width="1.5"/>
  <text x="275" y="218" text-anchor="middle" fill="#9cdcfe" font-size="11">table[2]</text>

  <!-- ========== ROW 0 ========== -->
  <line x1="320" y1="133" x2="398" y2="133" stroke="#569cd6" stroke-width="2" marker-end="url(#arrow)"/>

  <text x="590" y="108" text-anchor="middle" fill="#569cd6" font-size="10">Row 0: new int[4]</text>
  <rect x="410" y="114" width="380" height="38" rx="4" fill="#2d2d2d" stroke="#569cd6" stroke-width="1.5"/>

  <rect x="420" y="122" width="80" height="24" rx="3" fill="#1e1e1e" stroke="#569cd655" stroke-width="1"/>
  <text x="460" y="138" text-anchor="middle" fill="#b5cea8" font-size="13" font-weight="bold">1</text>

  <rect x="506" y="122" width="80" height="24" rx="3" fill="#1e1e1e" stroke="#569cd655" stroke-width="1"/>
  <text x="546" y="138" text-anchor="middle" fill="#b5cea8" font-size="13" font-weight="bold">2</text>

  <rect x="592" y="122" width="80" height="24" rx="3" fill="#1e1e1e" stroke="#569cd655" stroke-width="1"/>
  <text x="632" y="138" text-anchor="middle" fill="#b5cea8" font-size="13" font-weight="bold">3</text>

  <rect x="678" y="122" width="80" height="24" rx="3" fill="#1e1e1e" stroke="#569cd655" stroke-width="1"/>
  <text x="718" y="138" text-anchor="middle" fill="#b5cea8" font-size="13" font-weight="bold">4</text>

  <!-- Index labels for row 0 -->
  <text x="460" y="160" text-anchor="middle" fill="#aaa" font-size="9">[0][0]</text>
  <text x="546" y="160" text-anchor="middle" fill="#aaa" font-size="9">[0][1]</text>
  <text x="632" y="160" text-anchor="middle" fill="#aaa" font-size="9">[0][2]</text>
  <text x="718" y="160" text-anchor="middle" fill="#aaa" font-size="9">[0][3]</text>

  <!-- ========== ROW 1 ========== -->
  <line x1="320" y1="173" x2="398" y2="193" stroke="#dcdcaa" stroke-width="2" marker-end="url(#arrow-amber)"/>

  <text x="590" y="220" text-anchor="middle" fill="#dcdcaa" font-size="10">Row 1: new int[4]</text>
  <rect x="410" y="176" width="380" height="38" rx="4" fill="#2d2d2d" stroke="#dcdcaa" stroke-width="1.5"/>

  <rect x="420" y="184" width="80" height="24" rx="3" fill="#1e1e1e" stroke="#dcdcaa55" stroke-width="1"/>
  <text x="460" y="200" text-anchor="middle" fill="#b5cea8" font-size="13" font-weight="bold">5</text>

  <rect x="506" y="184" width="80" height="24" rx="3" fill="#1e1e1e" stroke="#dcdcaa55" stroke-width="1"/>
  <text x="546" y="200" text-anchor="middle" fill="#b5cea8" font-size="13" font-weight="bold">6</text>

  <rect x="592" y="184" width="80" height="24" rx="3" fill="#1e1e1e" stroke="#dcdcaa55" stroke-width="1"/>
  <text x="632" y="200" text-anchor="middle" fill="#b5cea8" font-size="13" font-weight="bold">7</text>

  <rect x="678" y="184" width="80" height="24" rx="3" fill="#1e1e1e" stroke="#dcdcaa55" stroke-width="1"/>
  <text x="718" y="200" text-anchor="middle" fill="#b5cea8" font-size="13" font-weight="bold">8</text>

  <!-- ========== ROW 2 ========== -->
  <line x1="320" y1="213" x2="398" y2="253" stroke="#4ec9b0" stroke-width="2" marker-end="url(#arrow-green)"/>

  <text x="590" y="284" text-anchor="middle" fill="#4ec9b0" font-size="10">Row 2: new int[4]</text>
  <rect x="410" y="240" width="380" height="38" rx="4" fill="#2d2d2d" stroke="#4ec9b0" stroke-width="1.5"/>

  <rect x="420" y="248" width="80" height="24" rx="3" fill="#1e1e1e" stroke="#4ec9b055" stroke-width="1"/>
  <text x="460" y="264" text-anchor="middle" fill="#b5cea8" font-size="13" font-weight="bold">9</text>

  <rect x="506" y="248" width="80" height="24" rx="3" fill="#1e1e1e" stroke="#4ec9b055" stroke-width="1"/>
  <text x="546" y="264" text-anchor="middle" fill="#b5cea8" font-size="13" font-weight="bold">10</text>

  <rect x="592" y="248" width="80" height="24" rx="3" fill="#1e1e1e" stroke="#4ec9b055" stroke-width="1"/>
  <text x="632" y="264" text-anchor="middle" fill="#b5cea8" font-size="13" font-weight="bold">11</text>

  <rect x="678" y="248" width="80" height="24" rx="3" fill="#1e1e1e" stroke="#4ec9b055" stroke-width="1"/>
  <text x="718" y="264" text-anchor="middle" fill="#b5cea8" font-size="13" font-weight="bold">12</text>

  <!-- Allocation count callout -->
  <rect x="30" y="180" width="155" height="80" rx="6" fill="#dc354510" stroke="#dc3545" stroke-width="1.5" stroke-dasharray="4,2"/>
  <text x="40" y="200" fill="#dc3545" font-size="11" font-weight="bold">4 allocations:</text>
  <text x="40" y="216" fill="#d4d4d4" font-size="10">1 spine  (int*[3])</text>
  <text x="40" y="230" fill="#d4d4d4" font-size="10">3 rows   (int[4] each)</text>
  <text x="40" y="248" fill="#dc3545" font-size="10" font-weight="bold">4 calls to delete[]!</text>

  <!-- ============================================================ -->
  <!-- Separation line                                              -->
  <!-- ============================================================ -->
  <line x1="30" y1="305" x2="830" y2="305" stroke="#555" stroke-width="1" stroke-dasharray="6,3"/>

  <!-- ============================================================ -->
  <!-- DELETE ORDER                                                  -->
  <!-- ============================================================ -->
  <text x="30" y="335" fill="#dc3545" font-size="15" font-weight="bold">Freeing: rows first, then spine (reverse order!)</text>

  <!-- Step 1: Delete rows -->
  <rect x="30" y="350" width="390" height="55" rx="4" fill="#2d2d2d" stroke="#555" stroke-width="1"/>
  <text x="45" y="370" fill="#d7ba7d" font-size="12">for (int i = 0; i &lt; rows; ++i)</text>
  <text x="45" y="390" fill="#d7ba7d" font-size="12">    delete[] table[i];  <tspan fill="#6a9955">// free each row</tspan></text>

  <!-- Arrow -->
  <text x="435" y="380" fill="#569cd6" font-size="14">→</text>

  <!-- Step 2: Delete spine -->
  <rect x="460" y="350" width="370" height="55" rx="4" fill="#2d2d2d" stroke="#555" stroke-width="1"/>
  <text x="475" y="370" fill="#d7ba7d" font-size="12">delete[] table;       <tspan fill="#6a9955">// free spine</tspan></text>
  <text x="475" y="390" fill="#d7ba7d" font-size="12">table = nullptr;      <tspan fill="#6a9955">// safety</tspan></text>

  <!-- Warning callout -->
  <rect x="460" y="413" width="370" height="28" rx="4" fill="#dc354510" stroke="#dc3545" stroke-width="1"/>
  <text x="475" y="432" fill="#dc3545" font-size="11">⚠ Delete spine first → row pointers lost → LEAK!</text>
</svg>
